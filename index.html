
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Kamranicus</title>
  <meta name="author" content="Kamran">

  
  <meta name="description" content="Kamranicus
Personal and development blog of Kamran Ayub about me Hi, my name is Kamran. I am a web developer and designer, residing in Minnesota. I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kamranicus.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/Kamranicus" rel="alternate" title="Kamranicus" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1203259-13']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

  <body>
    <a href="/" class="home-icon">
      <img src="/images/home.png"/>
    </a>

    <div class="home-page">
  <div class="hero">
    <h1>Kamranicus</h1>
<p>Personal and development blog of Kamran Ayub</p>

  </div>

  <div class="home-field">
    <div class="home-landing her-row">
      <div class="container">
        <div class="row">
          <div id="about-me" class="col-md-offset-3 col-md-6">
  <h4>about me</h4>
  <p>Hi, my name is Kamran. I am a web developer and designer,  residing in Minnesota. I&#8217;ve been programming since 2001 and  I am familiar with many different languages, both web-based  and server-based. I love to tinker around and think of new  ways to solve problems.
</p>
  <div class="social-icon-list">
  	
    <a title="Twitter" href="https://twitter.com/kamranayub"><img src="/images/glyphicons_social_31_twitter.png"/></a>
    
    
    <a title="GitHub" href="https://github.com/kamranayub"><img src="/images/glyphicons_social_21_github.png"/></a>
    
    
    
  </div>
</div>

        </div>
      </div>
    </div>

    <div class="article-list">
      <div class="container">
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/2016/08/12/posh-openweathermap-powershell-module/">OpenWeatherMap PowerShell Module</a></h2>
  
  <p>
    <p>There&rsquo;s no better to way to learn something new than to make a thing. Yesterday I had a strong desire to know what the weather was like from my command prompt. I can&rsquo;t explain it&mdash;I just had to and I thought, &ldquo;Hey, it can&rsquo;t be that bad, right?&rdquo; I decided to try writing and releasing an open-source PowerShell module.</p>




  </p>
  <span class="meta">
    written 








  



<time datetime="2016-08-12T00:15:00+00:00" pubdate data-updated="true">Aug 12<span>th</span>, 2016</time>
    

in
<span class="categories">
  
    <a class='category' href='/blog/categories/oss/'>OSS</a>, <a class='category' href='/blog/categories/powershell/'>PowerShell</a>
  
</span>


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2016/08/12/posh-openweathermap-powershell-module/">Read on &rarr;</a>
  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/2016/08/12/midwestjs-demystifying-typescript/">Demystifying TypeScript at Midwest.js</a></h2>
  
  <p>
    <p>Today I was excited to give a talk at <a href="http://midwestjs.com">Midwest.js</a> about <a href="http://kamranicus.com/presentations/demystifying-typescript">Demystifying TypeScript</a>. This is not the first time I&rsquo;ve given the talk, it&rsquo;s actually the <strong>fourth</strong> time. Instead of leaving it stale I revamped the theme and updated all the information to be current as of today&mdash;including information about <a href="https://babeljs.io/">Babel.js</a> and <a href="https://flowtype.org/">Flow</a>.</p>




<p>Unfortunately due to technical difficulties (no HDMI-to-DisplayPort adapter!) the talk&rsquo;s <em>video</em> wasn&rsquo;t recorded. However, I was mic&rsquo;d and I did use SnagIt to record my screen, so we&rsquo;re hoping we can merge the audio and video tracks to generate a recording. If not, I may need to sit down and record audio for the talk.</p>




<p>I will update this post after the conference and let you know the status&mdash;let&rsquo;s hope we can get it working! Otherwise, I guess you just had to be there ;)</p>




<p>If you attended and have questions, feel free to leave them here or <a href="http://twitter.com/kamranayub">tweet</a> at me!</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2016-08-12T00:09:00+00:00" pubdate data-updated="true">Aug 12<span>th</span>, 2016</time>
    

in
<span class="categories">
  
    <a class='category' href='/blog/categories/conferences/'>Conferences</a>, <a class='category' href='/blog/categories/javascript/'>Javascript</a>, <a class='category' href='/blog/categories/talks/'>Talks</a>, <a class='category' href='/blog/categories/typescript/'>TypeScript</a>
  
</span>


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/2016/07/31/aspnet-core-demo-game/">ASP.NET Core Sample Demo Game</a></h2>
  
  <p>
    <p>At General Mills we do semi-annual code camps where the developer organization gets together for a half-day of talks and fun. This past code camp myself and my partner in crime, <a href="http://twitter.com/erikonarheim">Erik Onarheim</a> gave a talk around ASP.NET Core. It&rsquo;s part of our roadmap to be familiar with hosting ASP.NET Core so we wanted to build something and showcase to developers what&rsquo;s changed in Core vs. the typical Framework application.</p>




<p>We made a trivial demo game built on top of SignalR and .NET Core while also showing off other new features of the stack, including:</p>




<ul>
<li>Depdendency Injection</li>
<li>Custom Tag Helpers</li>
<li>Cascading Configuration</li>
<li>Multi-Environment Support</li>
<li>Strongly-Typed Options</li>
<li>Injecting Services into Views</li>
<li>Injected MVC Filters</li>
<li>Bundling &amp; Minification</li>
<li>Publishing to Azure</li>
</ul>




<p>We had the demo running on Azure during the talk so people could join the game and we even attempted showing Linux support, though web sockets were not behaving nicely behind nginx. The game is not really a game but more of a showcase of using web sockets to allow some real-time multiplayer server action. It is definitely <em>not</em> how you&rsquo;d implement a &ldquo;real&rdquo; multiplayer game but it&rsquo;s a fun demo.</p>




<p>You can check out the source code on GitHub: <a href="https://github.com/eonarheim/aspnet-core-demogame">https://github.com/eonarheim/aspnet-core-demogame</a>. It&rsquo;s commented pretty heavily to help understand the different parts, it&rsquo;s based on the default out-of-the-box web template (<code>dotnet new -t web</code>).</p>




<p>We may or may not upload the talk onto YouTube since there wasn&rsquo;t really anything specific about our work until the very end, which we can strip out without losing any important bits.</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2016-07-31T18:05:00+00:00" pubdate data-updated="true">Jul 31<span>st</span>, 2016</time>
    

in
<span class="categories">
  
    <a class='category' href='/blog/categories/dot-net-core/'>.NET Core</a>, <a class='category' href='/blog/categories/asp-dot-net/'>ASP.NET</a>, <a class='category' href='/blog/categories/c-number/'>C#</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/signalr/'>SignalR</a>
  
</span>


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/2016/05/08/cassette-subresource-integrity-sri/">Adding Subresource Integrity Support to Cassette .NET</a></h2>
  
  <p>
    <p>If you aren&rsquo;t familiar with <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">Subresource Integrity</a>, it&rsquo;s a browser-based security measure to protect embedded content like scripts and stylesheets using a file content hash to help protect against XSS attacks.</p>




<p>For example, let&rsquo;s say you&rsquo;re including a script from a CDN:</p>




<pre><code>&lt;script src="https://mycdn.com/jquery/1.0/jquery.js"&gt;&lt;/script&gt;
</code></pre>




<p>Then let&rsquo;s say the CDN is compromised and instead of returning jquery, the script returns some malicious code that could compromise your site. Even if you&rsquo;re using Content Security Policy (CSP), you won&rsquo;t be protected because you whitelisted the CDN.</p>




<p>Subresource Integrity allows you to put a hash of the file&rsquo;s contents in an attribute of the tag. The browser will then hash the contents of the response from the CDN and compare it against the attribute provided. If the hashes don&rsquo;t match, the browser won&rsquo;t include the response and will throw an error.</p>




<pre><code>&lt;script src="https://mycdn.com/jquery/1.0/jquery.js" integrity="sha256-hfhsh02929fhgh303yg"&gt;&lt;/script&gt;
</code></pre>




<h2>Integrating with Cassette</h2>




<p>I use <a href="http://getcassette.net">Cassette</a> to perform my bundling/minification and I also <a href="http://kamranicus.com/blog/2015/10/10/azure-cdn-cassette/">host my assets on a CDN</a>. Even though they are my own assets, I still want to ensure they are served securely and take advantage of SRI.</p>




<p>For third-party scripts, it is fairly easy to take advantage of SRI by <a href="https://srihash.org/">hashing the contents online</a> and customizing the CDN reference in Cassette:</p>




<pre><code>bundles.AddUrl("http://mycdn.com/jquery/1.0/jquery.js", bundle =&gt;
    bundle.HtmlAttributes.Add("integrity", "sha256-jquerysfilehash"));
</code></pre>




<p>But since my <em>own</em> files are dynamic, how can we still leverage Cassette <em>and</em> automatically hash the file contents when outputting to the page?</p>




<p>Luckily, Cassette is pretty extensible and includes a way to <a href="http://getcassette.net/documentation/v2/bundle-pipelines">customize the bundle pipeline</a>. So what we can do is essentially override the rendering of the HTML and add the <code>integrity</code> tag to the output.</p>




<p>To make this easy, I&rsquo;ve created an open source Nuget package called <a href="https://github.com/kamranayub/cassette-sri">Cassette.SubresourceIntegrity</a>. All you do is install the package and <strong>that&rsquo;s it.</strong> Since Cassette automatically scans for bundle customizations, all I did was implement a class <code>InsertIntoPipelineSubresourceIntegrity</code> and modify the pipeline to replace a couple parts with SRI-aware code.</p>




<p>The meat of the change is this code here:</p>




<pre><code>string integrity;

using (var stream = asset.OpenStream())
{
    using (var sha256 = SHA256.Create())
    {
        integrity = $"integrity=\"sha256-{Convert.ToBase64String(sha256.ComputeHash(stream))}\"";
    }
}

return $"&lt;script src=\"{_urlGenerator.CreateAssetUrl(asset)}\" " +
       $"type=\"text/javascript\" " +
       $"{integrity}{bundle.HtmlAttributes.ToAttributeString()}&gt;&lt;/script&gt;";
</code></pre>




<p>I am just getting the asset stream and hashing the contents using SHA256, then adding the attribute to the output. You&rsquo;ll notice that the <strong>URLs are not changed</strong>, so Cassette will continue to use SHA1 hashes internally. It&rsquo;s <em>only when rendering</em> we use SHA256 because that&rsquo;s the only place we need it.</p>




<p>While the code is interesting, it&rsquo;s nothing too crazy&mdash;in fact, most of the code required is because Cassette doesn&rsquo;t expose certain needed classes used in the rendering pipeline so I had to basically copy/paste a lot of the helper classes.</p>




<h2>The end result</h2>




<p>Now Cassette will automatically include SRI hashes for individual assets:</p>




<pre><code>&lt;link href="cassette.axd/asset/Content/bootstrap/bootstrap-ext.css?cabc6264a89106c4b9021c293cfa5c2cae7a0549" 
    integrity="sha256-sNfA6O5zvZPmMJ474pm2w6UyZbz5tfukxTEZXrsLm7Q=" type="text/css" rel="stylesheet"/&gt;
&lt;link href="cassette.axd/asset/Content/modules/typeahead.css?00581b47ff3848da273d91c31adb8270e9ef8707" 
    integrity="sha256-W6JAiwRw2ER1QoXjXL/YxsY/On1Y7MhW4TtoWY0XuH8=" type="text/css" rel="stylesheet"/&gt;
&lt;link href="cassette.axd/asset/Content/modules/toastr.css?32e90a136e05728ac23995ff8fe33077df9f50ca" 
    integrity="sha256-JT6UwDlczdRDx+9mnMCzvxwABJP0cSDgNLmT+WumJrQ=" type="text/css" rel="stylesheet"/&gt;
&lt;link href="cassette.axd/asset/Content/hopscotch/hopscotch.css?58ea04e54df958c33cf9e6bfed9f39a166354e9c" 
    integrity="sha256-Bq06LI6L0XMhxF+CoJo+4L12w2Orsbh2oRjOZ+fpmWc=" type="text/css" rel="stylesheet"/&gt;
&lt;link href="cassette.axd/asset/Content/core.css?a3b4fcb8b7d9b0e8465a4fea29d60247ea47fd87" 
    integrity="sha256-fAqyFLkOx1cFONu7NXX3c7/G1DSmXeHgtPtcWU72a4E=" type="text/css" rel="stylesheet"/&gt;
&lt;link href="cassette.axd/asset/Content/library.css?2c2746a086737dc588e313c0cc2c5adf8b947605" 
    integrity="sha256-SaP9kdYfbafIVes+qntAiDLPsi4JaXnit4eN6IfU9lA=" type="text/css" rel="stylesheet"/&gt;
</code></pre>




<p><em>and</em> bundles:</p>




<pre><code>&lt;link href="cassette.axd/stylesheet/ba58f2a04873e41b6a599274ea6768db1a61a650/Content/core" 
    integrity="sha256-thzkrIApz9dAI9nfJGleO1jbNFXXVT/BxoSynI2pEPw=" type="text/css" rel="stylesheet"/&gt;
&lt;link href="cassette.axd/stylesheet/2c2746a086737dc588e313c0cc2c5adf8b947605/Content/library.css" 
    integrity="sha256-6LgYbxu4UwouRBqvUdHZAQc0lewdik6aZYpDgrtAWJ4=" type="text/css" rel="stylesheet"/&gt;
</code></pre>




<p>Voila!</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2016-05-08T05:13:00+00:00" pubdate data-updated="true">May 8<span>th</span>, 2016</time>
    

in
<span class="categories">
  
    <a class='category' href='/blog/categories/c-number/'>C#</a>, <a class='category' href='/blog/categories/nuget/'>Nuget</a>, <a class='category' href='/blog/categories/oss/'>OSS</a>, <a class='category' href='/blog/categories/security/'>Security</a>
  
</span>


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/2016/05/08/ludum-dare-35-game-jam/">Designing Hexshaper, a Game for the Ludum Dare 35 Game Jam</a></h2>
  
  <p>
    <p>This last weekend I took part in the global <a href="http://ludumdare.com">Ludum Dare 35</a> game jam. If you&rsquo;ve been following me for awhile, you know I&rsquo;ve participated in the past too. This time we <a href="http://excaliburjs.com/ludum-35">made a game called Hexshaper</a>&mdash;where the goal is to fly around, absorbing magic to seal portals to another dimension to prevent monsters from overtaking the world. The backstory, while not communicated directly, informed our design&mdash;but it wasn&rsquo;t like that at first.</p>




  </p>
  <span class="meta">
    written 








  



<time datetime="2016-05-08T02:10:00+00:00" pubdate data-updated="true">May 8<span>th</span>, 2016</time>
    

in
<span class="categories">
  
    <a class='category' href='/blog/categories/excalibur-dot-js/'>Excalibur.js</a>, <a class='category' href='/blog/categories/game-jams/'>Game Jams</a>, <a class='category' href='/blog/categories/games/'>Games</a>, <a class='category' href='/blog/categories/javascript/'>Javascript</a>, <a class='category' href='/blog/categories/ludum-dare/'>Ludum Dare</a>, <a class='category' href='/blog/categories/typescript/'>TypeScript</a>
  
</span>


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2016/05/08/ludum-dare-35-game-jam/">Read on &rarr;</a>
  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/2016/04/11/tccc20-typescript-in-action/">TypeScript in Action at Twin Cities Code Camp 20 (TCCC20)</a></h2>
  
  <p>
    <p><strong>Update (4/20/16)</strong>: The presentation is now up on <a href="https://www.youtube.com/watch?v=eeh-FcC6Sew">YouTube</a> (and <a href="http://kamranicus.com/presentations/typescript-in-action/#/">the slides</a>).</p>




<iframe width="420" height="315" src="https://www.youtube.com/embed/eeh-FcC6Sew" frameborder="0" allowfullscreen></iframe>




<hr />




<p>I&rsquo;ll be speaking at 8:30am this weekend at <a href="http://twincitiescodecamp.com">Twin Cities Code Camp</a>. My talk will about using TypeScript
in the context of an Angular 2 ASP.NET MVC web application but will focus on how TypeScript enhances my productivity and showcases some features of the language. I&rsquo;ve done the talk previously internally at General Mills and had a great response so I thought I&rsquo;d piggyback on the success of my previous <a href="http://kamranicus.com/presentations/demystifying-typescript/#/">Demystifying TypeScript</a> talk (which is also on <a href="https://www.youtube.com/watch?v=kb7tvaBJeMs">YouTube</a>).</p>




<p>If you&rsquo;re at all interested in seeing how TypeScript development looks in action, you should attend and I&rsquo;d recommend going through my
previous talk if you&rsquo;re still not convinced TypeScript is awesome. This talk assumes you are at least open to the idea of developing
in TypeScript and are curious to see how it can be used.</p>




<p>It&rsquo;ll be a fun time and a busy weekend&mdash;I&rsquo;ll have to leave the conference right after my talk to participate in Ludum Dare, where I&rsquo;ll
be helping to build a game in 72 hours. I&rsquo;m sad I&rsquo;ll miss the speaker happy hour and the prizes but it&rsquo;s for a good reason!
Hope to see you Saturday!</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2016-04-11T18:38:00+00:00" pubdate data-updated="true">Apr 11<span>th</span>, 2016</time>
    

in
<span class="categories">
  
    <a class='category' href='/blog/categories/conferences/'>Conferences</a>, <a class='category' href='/blog/categories/javascript/'>JavaScript</a>, <a class='category' href='/blog/categories/talks/'>Talks</a>, <a class='category' href='/blog/categories/typescript/'>TypeScript</a>
  
</span>


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/2016/04/05/wmf5-powershell-dsc-generating-encryption-certificate/">Generating an Encryption Certificate for PowerShell DSC in WMF5</a></h2>
  
  <p>
    <p>I&rsquo;m currently building out a PowerShell DSC pull server cluster at work. If you aren&rsquo;t familiar with DSC, I&rsquo;ll talk more about it in an upcoming post that ties it all together. The long and short of it is that DSC is a way to store configuration as code and automate the configuration of many servers at once.</p>




<p>In the recent Windows Management Framework 5 release, Microsoft has improved its support and feature set for DSC but with a new release comes new surprises. The first surprise you may run into, as we did, was that your old WMF4 way of encrypting MOF files doesn&rsquo;t work. In WMF5, the requirements for the certificate used to secure MOF files is stricter. <a href="https://msdn.microsoft.com/en-us/powershell/dsc/securemof">Taken from MSDN</a>:</p>




<ol>
<li>Key Usage:</li>
<li>Must contain: &lsquo;KeyEncipherment&rsquo; and &lsquo;DataEncipherment&rsquo;.</li>
<li>Should <em>not</em> contain: &lsquo;Digital Signature&rsquo;.</li>
<li>Enhanced Key Usage:</li>
<li>Must contain: Document Encryption (1.3.6.1.4.1.311.80.1).</li>
<li>Should <em>not</em> contain: Client Authentication (1.3.6.1.5.5.7.3.2) and Server Authentication (1.3.6.1.5.5.7.3.1).</li>
</ol>




<p>If you read my <a href="http://kamranicus.com/blog/2016/02/24/azure-key-vault-config-encryption-azure/">previous foray into certificates with Azure Key Vault</a>, you know I&rsquo;m pretty green when it comes to certificate management and terminology. I really didn&rsquo;t know what this stuff meant&mdash;I mean, I understand a certificate has key usages and enhanced key usages, but <strong>how does it get them?</strong> It has to do with the certificate request and the template used to provision your certificate.</p>




<p>It turns out Microsoft recommends obtaining a certificate from Active Directory Certificate Services. That&rsquo;s cool, but I&rsquo;m just a developer who wants to work on DSC, I don&rsquo;t have an ADCS server to give me certificates during testing&mdash;that&rsquo;s a different team altogether and when they&rsquo;re primary guy is out of the office, I&rsquo;m a bit stuck.</p>




<p><strong>Update (4/13)</strong>: <a href="https://msdn.microsoft.com/en-us/powershell/dsc/securemof">TechNet</a> now has a guide on how to generate certificates for WMF5. I&rsquo;m leaving the rest of this post as-is for posterity.</p>




<hr />




<p>I thought I could maybe use a self-signed certificate while I wait for a &ldquo;for real&rdquo; one later. After searching around for a method to create a certificate with the required KU and EKU specs, I found a lot of answers suggesting using OpenSSL. I&rsquo;ve never used OpenSSL before so I thought I&rsquo;d give it a try and I found it a bit confusing&mdash;I think I could have gotten it to work but instead I came across a random PowerShell article (unrelated to anything) using a utility called <code>certreq</code> that could handle providing custom key usages, problem solved!</p>




<p>You just need to create a file to define your certificate settings, <strong>MyCert.inf</strong>:</p>


<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Version]
</span><span class='line'>Signature = &ldquo;$Windows NT$&rdquo;
</span><span class='line'>
</span><span class='line'>[Strings]
</span><span class='line'>szOID_ENHANCED_KEY_USAGE = &ldquo;2.5.29.37&rdquo;
</span><span class='line'>szOID_DOCUMENT_ENCRYPTION = &ldquo;1.3.6.1.4.1.311.80.1&rdquo;
</span><span class='line'>
</span><span class='line'>[NewRequest]
</span><span class='line'>Subject = &ldquo;cn=<a href="&#x6d;&#97;&#x69;&#108;&#116;&#111;&#x3a;&#109;&#101;&#64;&#x65;&#120;&#97;&#x6d;&#x70;&#108;&#x65;&#46;&#x63;&#111;&#109;">&#x6d;&#101;&#64;&#x65;&#x78;&#x61;&#109;&#x70;&#108;&#101;&#46;&#99;&#x6f;&#109;</a>&rdquo;
</span><span class='line'>MachineKeySet = false
</span><span class='line'>KeyLength = 2048
</span><span class='line'>KeySpec = AT_KEYEXCHANGE
</span><span class='line'>HashAlgorithm = Sha1
</span><span class='line'>Exportable = true
</span><span class='line'>RequestType = Cert
</span><span class='line'>
</span><span class='line'>KeyUsage = &ldquo;CERT_KEY_ENCIPHERMENT_KEY_USAGE | CERT_DATA_ENCIPHERMENT_KEY_USAGE&rdquo;
</span><span class='line'>ValidityPeriod = &ldquo;Years&rdquo;
</span><span class='line'>ValidityPeriodUnits = &ldquo;1000&rdquo;
</span><span class='line'>
</span><span class='line'>[Extensions]
</span><span class='line'>%szOID_ENHANCED_KEY_USAGE% = &ldquo;{text}%szOID_DOCUMENT_ENCRYPTION%&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p>Just change the <code>Subject</code> line to whatever you need in your case.</p>




<p>Then execute <code>certreq</code> using the input file:</p>




<pre><code>certreq -new MyCert.inf MyCert.cer
</code></pre>




<p>Certreq should be available if you have Makecert&mdash;if you aren&rsquo;t finding it in the default command prompt, try using the Visual Studio Command Prompt. Once you execute the command it will generate a public key file and install the private/public key pair into your <code>CurrentUser</code> personal certificate store:</p>




<pre><code>PS&gt; dir Cert:\CurrentUser\My
</code></pre>




<p>From there, you can export the private/public keys and install it on your DSC nodes.</p>




<p><img src="https://cloud.githubusercontent.com/assets/563819/14269791/dac55acc-fa9c-11e5-8352-55881c3150ed.png" alt="Example screenshot" /></p>




<p>Until you get a signed certificate from your CA, this should work. Hope that helps!</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2016-04-05T03:43:00+00:00" pubdate data-updated="true">Apr 5<span>th</span>, 2016</time>
    

in
<span class="categories">
  
    <a class='category' href='/blog/categories/dsc/'>DSC</a>, <a class='category' href='/blog/categories/powershell/'>PowerShell</a>, <a class='category' href='/blog/categories/security/'>Security</a>
  
</span>


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/2016/03/11/attending-build-2016/">See You at Build 2016</a></h2>
  
  <p>
    <p>I love attending conferences. At the end of the month I&rsquo;ll be attending <a href="http://buildwindows.com">Build 2016</a>. Build is the annual Microsoft conference. At the end of January me and some friends <a href="https://www.instagram.com/p/BBJQ-PTuIzZ">attended PAX South</a> in San Antonio and it was a blast (not for work). A gaming convention has a different air than a developer conference. There&rsquo;s a certain energy and it&rsquo;s very motivating being around fellow developers, learning new tech, and seeing what&rsquo;s new. I&rsquo;ve attended Build several times in the past and it&rsquo;s always been fun&mdash;especially <a href="http://kamranicus.com/blog/posts/7/mix-11-day-2-kinects-celebrities-kings-and-clubbin/">when you meet coding &ldquo;celebs&rdquo;</a>. Usually I take my wife even though she doesn&rsquo;t attend the conference, we will typically stay longer. This year, not only will she be joining but our friend will be coming as well&mdash;both of them will be traipsing around San Francisco while I and a few coworkers will attend the conference. My partners in crime, <a href="http://twitter.com/erikonarheim">Erik</a> &amp; <a href="http://twitter.com/alangrgic">Alan</a>, will be joining me so it&rsquo;ll be a <em>ton</em> of fun (yes, we all work together and yes we <em>just</em> went to PAX together). Going to a conference is fun, going to a conference <em>with your friends</em> is even more fun.</p>




<p>After Build we&rsquo;ll be leaving my coworkers behind and we&rsquo;ll be flying up to Portland to explore the area. I&rsquo;ve been to downtown Seattle for PAX Prime before but I&rsquo;ve only been in the surrounding area once when I was a teenager and I always thought it was beautiful. My wife never has been to the Pacific northwest so we thought it&rsquo;d be fun to spend a few days extra and drive around. We&rsquo;re all looking forward to it.</p>




<p>If you&rsquo;re at Build and you follow me, be sure to <a href="http://twitter.com/kamranayub">send me a tweet</a> and we&rsquo;ll meet up!</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2016-03-11T00:31:00+00:00" pubdate data-updated="true">Mar 11<span>th</span>, 2016</time>
    

in
<span class="categories">
  
    <a class='category' href='/blog/categories/azure/'>Azure</a>, <a class='category' href='/blog/categories/conferences/'>Conferences</a>, <a class='category' href='/blog/categories/microsoft/'>Microsoft</a>
  
</span>


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/2016/03/06/cors-multiple-origins-iis/">Handling Multiple Origins in CORS Using URL Rewrite</a></h2>
  
  <p>
    <p>Here&rsquo;s a quick tip if you&rsquo;re trying to figure out how to handle <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">cross-origin requests (CORS)</a> when you have multiple origins (namely, HTTP and HTTPS). This works in IIS 8.0 and above, including Azure, as long as you have the <a href="http://www.iis.net/downloads/microsoft/url-rewrite">URL Rewrite module</a> installed.</p>




<p>The CORS header looks like this:</p>


<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Access-Control-Allow-Origin: <a href="http://mydomain.com">http://mydomain.com</a></span></code></pre></td></tr></table></div></figure></p>

<p>The spec is very strict. The header can only return a single value and it must be absolutely qualified, which means if you have a site that is served over HTTP and HTTPS (or multiple domains), you need to <em>dynamically</em> build this header in your response. Many tutorials and blog posts say to specify <code>*</code> as the value&mdash;<strong>DO NOT DO THIS!</strong> This means any origin (domain) can embed/request assets from your website. Unless you have hundreds of sites doing this (aka CDN), you should only whitelist the domains that can include resources from your site.</p>




<p>If you are sharing resources with a known number of hosts, the following method will help. If it&rsquo;s a <em>dynamic</em> list, you will need to programmatically add the <code>Access-Control-Allow-Origin</code> header depending on the incoming <code>Origin</code> header&mdash;something I won&rsquo;t cover here.</p>




<p>Rather than messing with C# and modifying outgoing responses what I ended up using was a simple URL rewrite rule, proposed by <a href="http://stackoverflow.com/a/31084390/109458">this Stack Overflow answer</a>. All it does is add a header to the outbound response when the regular expression matches&mdash;in this case, whitelisting only the HTTP and HTTPS version of my domain (or subdomain).</p>


<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;system.webServer&gt;
</span><span class='line'>   &lt;httpProtocol&gt;
</span><span class='line'>     &lt;customHeaders&gt;
</span><span class='line'>         &lt;add name=&ldquo;Access-Control-Allow-Headers&rdquo; value=&ldquo;Origin, X-Requested-With, Content-Type, Accept&rdquo; /&gt;
</span><span class='line'>         &lt;add name=&ldquo;Access-Control-Allow-Methods&rdquo; value=&ldquo;POST,GET,OPTIONS,PUT,DELETE&rdquo; /&gt;
</span><span class='line'>     &lt;/customHeaders&gt;
</span><span class='line'>   &lt;/httpProtocol&gt;
</span><span class='line'>   &lt;rewrite&gt;          <br/>
</span><span class='line'>      &lt;outboundRules&gt;
</span><span class='line'>          &lt;clear /&gt;              <br/>
</span><span class='line'>          &lt;rule name=&ldquo;AddCrossDomainHeader&rdquo;&gt;
</span><span class='line'>              &lt;match serverVariable=&ldquo;RESPONSE_Access_Control_Allow_Origin&rdquo; pattern=&ldquo;.*&rdquo; /&gt;
</span><span class='line'>              &lt;conditions logicalGrouping=&ldquo;MatchAll&rdquo; trackAllCaptures=&ldquo;true&rdquo;&gt;
</span><span class='line'>                  &lt;add input=&ldquo;{HTTP_ORIGIN}&rdquo; pattern=&ldquo;(http(s)?:\/\/((.+.)?mydomain.com))&rdquo; /&gt;
</span><span class='line'>              &lt;/conditions&gt;
</span><span class='line'>              &lt;action type=&ldquo;Rewrite&rdquo; value=&ldquo;{C:0}&rdquo; /&gt;
</span><span class='line'>          &lt;/rule&gt;         <br/>
</span><span class='line'>      &lt;/outboundRules&gt;
</span><span class='line'>   &lt;/rewrite&gt;
</span><span class='line'>&lt;/system.webServer&gt;</span></code></pre></td></tr></table></div></figure></p>

<p>This is using special syntax of the URL Rewrite module (<code>RESPONSE_</code>) to add a outgoing response header (dashes replaced with underscores). Then it matches the <em>incoming</em> <code>Origin</code> header, compares the value, and if it matches includes the CORS header with the value of my domain.</p>




<p>That was all I had to do!</p>




<p><strong>Note:</strong> Since I just converted over to always SSL, I no longer need this workaround but multiple origins is pretty common when dealing with CORS so this solution will come in handy.</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2016-03-06T15:50:00+00:00" pubdate data-updated="true">Mar 6<span>th</span>, 2016</time>
    

in
<span class="categories">
  
    <a class='category' href='/blog/categories/azure/'>Azure</a>, <a class='category' href='/blog/categories/c-number/'>C#</a>, <a class='category' href='/blog/categories/security/'>Security</a>
  
</span>


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/2016/02/24/azure-key-vault-config-encryption-azure/">Securing Secrets Using Azure Key Vault and Config Encryption</a></h2>
  
  <p>
    <p>Secrets. We all have them. I&rsquo;m talking about secrets like your database connection strings, API keys and encryption keys. Where are you storing yours? Are you storing them&hellip;</p>




<ol>
<li>In your application&rsquo;s source code?</li>
<li>In a config file (<code>appSettings</code> or otherwise) checked into source control?</li>
<li>In a database?</li>
<li>In a managed portal, like Azure?</li>
</ol>




<p>I hope you aren&rsquo;t storing them hardcoded. You&rsquo;re probably doing option 2 or a hybrid of options 2-4. Even if you use an external data source, it&rsquo;s hard to escape the need for secrets in local development unless you force your app to rely on having connectivity which makes it hard to work offline.</p>




<p>In this post I&rsquo;m going to provide some suggestions on how to store your secrets better using Azure Key Vault and config file encryption, specifically in the context of Azure but the concepts apply to any hosting environment.</p>




  </p>
  <span class="meta">
    written 








  



<time datetime="2016-02-24T02:30:00+00:00" pubdate data-updated="true">Feb 24<span>th</span>, 2016</time>
    

in
<span class="categories">
  
    <a class='category' href='/blog/categories/azure/'>Azure</a>, <a class='category' href='/blog/categories/c-number/'>C#</a>, <a class='category' href='/blog/categories/cloud/'>Cloud</a>, <a class='category' href='/blog/categories/encryption/'>Encryption</a>, <a class='category' href='/blog/categories/secrets/'>Secrets</a>, <a class='category' href='/blog/categories/security/'>Security</a>
  
</span>


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2016/02/24/azure-key-vault-config-encryption-azure/">Read on &rarr;</a>
  
</article>

            </div>
          </div>
        
      </div>
    </div>

    <hr class="divider-short"/>

    <div class="archive-link">
      <h3><a href="/blog/archives/">All Posts</a></h3>
    </div>
  </div>
</div>

    <footer id="footer" class="her-row">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
  <a href="/"><h4>Home</h4></a>
</div>

<div class="col-md-2">
  <div class="social-icon-list">
    
    <a href="https://twitter.com/kamranayub"><img src="/images/glyphicons_social_31_twitter.png"/></a>
    

    
    <a href="https://github.com/kamranayub"><img src="/images/glyphicons_social_21_github.png"/></a>
    

    

    
  </div>
</div>

<div class="pull-right">
  <h4>Powered by <a href="http://octopress.org/">Octopress</a>. Designed by <a href="http://AdrianArtiles.com">Adrian Artiles</a>.</h4>
</div>


    </div>
  </div>
</footer>

    
  </body>
</html>
