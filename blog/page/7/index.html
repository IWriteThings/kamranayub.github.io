
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Kamranicus</title>
  <meta name="author" content="Kamran">

  
  <meta name="description" content="Kamranicus
Personal and development blog of Kamran Ayub about me Hi, my name is Kamran. I am a web developer and designer, residing in Minnesota. I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kamranicus.com/blog/page/7">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/Kamranicus" rel="alternate" title="Kamranicus" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1203259-13']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

  <body>
    <a href="/" class="home-icon">
      <img src="/images/home.png"/>
    </a>

    <div class="home-page">
  <div class="hero">
    <h1>Kamranicus</h1>
<p>Personal and development blog of Kamran Ayub</p>

  </div>

  <div class="home-field">
    <div class="home-landing her-row">
      <div class="container">
        <div class="row">
          <div id="about-me" class="col-md-offset-3 col-md-6">
  <h4>about me</h4>
  <p>Hi, my name is Kamran. I am a web developer and designer,  residing in Minnesota. I&#8217;ve been programming since 2001 and  I am familiar with many different languages, both web-based  and server-based. I love to tinker around and think of new  ways to solve problems.
</p>
  <div class="social-icon-list">
  	
    <a title="Twitter" href="https://twitter.com/kamranayub"><img src="/images/glyphicons_social_31_twitter.png"/></a>
    
    
    <a title="GitHub" href="https://github.com/kamranayub"><img src="/images/glyphicons_social_21_github.png"/></a>
    
    
    
  </div>
</div>

        </div>
      </div>
    </div>

    <div class="article-list">
      <div class="container">
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/posts/40/ux-applies-to-api-design-too">UX Applies to API Design Too</a></h2>
  
  <p>
    <p>I&rsquo;m working on enhancing a component we use for cryptography at work today. Previously it had a lot of useful methods, but no documentation. I was able to add XML documentation and now it&rsquo;s fully Intellisense-friendly:</p>




<p><img src="/blog/images/38.png" alt="Intellisense" /></p>




<p>That&rsquo;s one step for making your API friendly, even though it&rsquo;s a little more work.</p>




<p>What I want to point out is that I also made exceptions friendly. Cryptography is not an easy thing to understand and even I don&rsquo;t understand all of it. We have a method that lets you generate a new key for a given algorithm (the API defaults to <code>RijndaelManaged</code> as best practice), but it also lets you specify a key size.</p>




<p>I did a couple things:</p>




<ol>
<li><p>The argument accepts key size in bits, as that is what the .NET API uses and is what you see online (&ldquo;128 bit&rdquo;).</p></li>
<li><p>The API will tell you if the key size is invalid. Not only that, it will list out what the acceptable key sizes are.</p></li>
</ol>




<p>Check it out:</p>


<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Test method SymmetricEncryption_Should_Throw_Exception_For_Invalid_Key_Sizes threw exception:
</span><span class='line'>
</span><span class='line'>System.ArgumentException: 56 bits is not a valid key size for RijndaelManaged. Valid key sizes: 128 bits, 192 bits, 256 bits
</span><span class='line'>
</span><span class='line'>Parameter name: keySize</span></code></pre></td></tr></table></div></figure></p>

<p>And it didn&rsquo;t even take much code:</p>




<script src="https://gist.github.com/2292726.js?file=SymmetricEncryption.cs"></script>




<p>Never forget:</p>




<blockquote><p>UX is just as important for API design</p></blockquote>




<p>Put yourself in your consumer&rsquo;s shoes and design it with them in mind. They&rsquo;ll thank you for it, trust me.</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2012-04-03T20:05:22+00:00" pubdate data-updated="true">Apr 3<span>rd</span>, 2012</time>
    


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/posts/39/a-few-hours-with-webapi-mvc-the-good-and-the-bad">A Few Hours With WebAPI + MVC, the Good and the Bad</a></h2>
  
  <p>
    <p>I&rsquo;m working on the next version of <a href="http://keeptrackofmygames.com">Keep Track of My Games</a> and it&rsquo;s an opportunity to upgrade to and play with MVC 4, especially the new <a href="http://asp.net/web-api">WebAPI</a>.</p>




<h2>Getting WebAPI</h2>




<p>This was not super apparent from the tutorials on asp.net but to get the WebAPI, you can simply obtain it from Nuget. Most of the tutorials start with File > New Project, but I wanted to incorporate it into a newly upgraded MVC 4 project. <em>Fun fact:</em> MVC4 is also available on Nuget, score!</p>




<p><img src="/blog/images/37.png" alt="Nuget" /></p>




<p>Which one?! Since there&rsquo;s no description or information regarding the &ldquo;Data&rdquo; package (assuming it will make it easy to integrate with EF), I went with the <strong>ASP.NET Web API (Beta)</strong> package.</p>




<h2>WebAPI is Not MVC</h2>




<p>I dislike things that cause friction. Unfortunately, there&rsquo;s some friction with using WebAPI for the first time. I&rsquo;m not sure if all of it can be removed, but hopefully some of it can be mitigated. If you haven&rsquo;t used WebAPI before, it&rsquo;s important to know <strong>WebAPI is not MVC</strong>.</p>




<p>Here&rsquo;s what I struggled with:</p>




<ol>
<li><p>Configuration is separate. You have to use the not-very-intuitively-named <code>GlobalConfiguration.Configuration</code> singleton to configure WebAPI. Seriously? Why not <code>HttpConfiguration</code> or even better, <code>ApiConfiguration</code>? To match typical MVC conventions (GlobalFilters.Filters, RouteTable.Routes), I&rsquo;d propose <code>HttpApi.Api</code> or something along those lines.</p></li>
<li><p>Routing is separate. I use <a href="https://github.com/mccalltd/AttributeRouting">AttributeRouting</a> and while I haven&rsquo;t explicitly tried it with WebAPI, I don&rsquo;t think it will work, but maybe it will. You register routes using the <code>MapHttpRoute</code> extension.</p></li>
<li><p>It doesn&rsquo;t plug into MVC&rsquo;s <code>DependencyResolver</code>. This was annoying. I use Ninject.MVC3 for my DI container, but that doesn&rsquo;t automatically make it available to WebAPI. Nay, <a href="http://haacked.com/archive/2012/03/11/itrsquos-the-little-things-about-asp-net-mvc-4.aspx">you have to jump through some hoops</a> to get it to work. Once you do, it works just as you&rsquo;d expect. <strong>Update:</strong> At a presentation today at Twin Cities Code Camp, Matt Milner presented on Web API and I saw he used a simpler method to plug Ninject into Web API:</p>

<pre><code> configuration.SetResolver(t =&gt; kernel.TryGet(t), t =&gt; kernel.GetAll(t));
</code></pre></li>
<li><p>Attributes are different. Do you have a custom <code>[Authorize]</code> attribute in MVC? You&rsquo;ll have to port it to WebAPI. This isn&rsquo;t a bad thing, it&rsquo;s just not apparent when you see this:</p>

<pre><code> [Authorize]
 Product GetProductById(int id) { }
</code></pre>

<p> To follow the convention, I prefixed my custom attributes with <code>Http</code> to make it more apparent they&rsquo;re different.</p></li>
<li><p>JSON.NET <em>will be</em> the default JSON serializer, but it&rsquo;s not <em>yet</em>. This means you have to register a custom formatter. I used the one <a href="http://www.west-wind.com/weblog/posts/2012/Mar/09/Using-an-alternate-JSON-Serializer-in-ASPNET-Web-API">on Rick Strahl&rsquo;s blog</a> (with some modifications) but you could try the several JsonNet Nuget packages for WebAPI (<a href="http://nuget.org/packages/WebAPIContrib.Formatters.JsonNet/0.6.0">WebAPIContrib.Formatters.JsonNet</a> or <a href="http://nuget.org/packages/netfx-WebApi.JsonNetFormatter/1.0.0.11">NetFx</a>).</p></li>
</ol>




<p>And that&rsquo;s about it. Once I overcame those &ldquo;frictions&rdquo; everything started to go smoothly. I haven&rsquo;t played with it a ton, but I&rsquo;m sure I&rsquo;ll write about it as I use it more.</p>




<h2>Removing the friction</h2>




<p>While I understand WebAPI is separate (but equal?) from MVC to allow for self-hosting or MVC-independent use cases, let&rsquo;s be honest: who are going to be the majority consumers of the API? MVC peeps. If there isn&rsquo;t already, there needs to be a &ldquo;bridge&rdquo; that makes it easier to use for MVC consumers.</p>




<p>The bridge should:</p>




<ol>
<li><strike>Plug into routing (so AttributeRouting sees it?)</strike> <a href="https://github.com/mccalltd/AttributeRouting/pull/57">I&rsquo;ve added Web API support</a> to AttributeRouting directly. It will be in v2.</li>
<li>Plug into whatever dependency resolver you have set</li>
<li>Do something else I haven&rsquo;t run into yet</li>
</ol>




<p>A Nuget package that added a WebActivator start up wouldn&rsquo;t be too hard. Maybe it doesn&rsquo;t even need to &ldquo;plug&rdquo; into the pipeline, it can simply make it easier to see and configure WebAPI. The auto-DI integration alone would be a big win.</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2012-04-03T18:42:13+00:00" pubdate data-updated="true">Apr 3<span>rd</span>, 2012</time>
    


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/posts/38/can-i-use-signalr-to-design-a-typical-single-page">Can I Use SignalR to Design a &#8220;Typical&#8221; Single Page Application?</a></h2>
  
  <p>
    <p>This post is a stream of conciousness kind of post. I know I may be totally off base on some things but I need somewhere to write this so I can review and think about it, maybe pose it to people and see where my thinking is flawed or if there&rsquo;s an obvious thing I&rsquo;m not seeing.</p>




<h2>The Context</h2>




<p>You&rsquo;re designing some sort of client-based application that communicates via AJAX (it can be Backbone, it can be Knockout, whatever). You&rsquo;re using ASP.NET MVC as the back end, maybe even the new fancy Web API.</p>




<h2>The Problem</h2>




<p>Let&rsquo;s say your API is supposed to be only used by your application; you have no intention of making it available for all to use. The problem is that no matter what measures you take, it&rsquo;s all HTTP and it&rsquo;s all public. For many of us, that isn&rsquo;t what we really want. If I make a URL <code>/api/users/{id}</code>, I really don&rsquo;t want other people requesting that URL.</p>




<p>So far in my Googling and experience, there are a few things you can do to <strong>reduce</strong> malicious abuse of your API:</p>




<ol>
<li>Issue session-based or cookie-based tokens with timeouts</li>
<li>Include Anti-CSRF tokens in your AJAX headers</li>
<li>Make sure people are authenticated before issuing authorizable requests</li>
<li>Do checks and throttle requests (no more than x requests from this user per second)</li>
</ol>




<p>I think these are problems we generally face even in a &ldquo;non-rich&rdquo; application (simple server-side design). I could easily issue 100 Fiddler requests per second against a page on your site and maybe bring it down. Including an AntiXssToken might help with that. Maybe we don&rsquo;t care about that. However, it seems the problem is exacerbated, or at least more apparent, when we&rsquo;re talking about AJAX requests because we&rsquo;re exposing our data in an easy-to-consume format (JSON/XML/etc). If not properly designed and secured, Joe Developer can write a client that consumes your API. For public APIs, this is great! For APIs you just want to use for your application&hellip; not so great.</p>




<p>One of the things I&rsquo;m not sure about is how site agnostic these defensive measures are and why it&rsquo;s so hard to find information on how to implement them. Can ASP.NET Web API bake these into the framework? Why or why not? Is this not so common as to warrant more real-world articles/tutorials on how to do it? Am I not searching correctly? Do most people not care?</p>




<blockquote><p>All I want is a not-so-public API my browser-based app can consume</p></blockquote>




<h2>What about SignalR?</h2>




<p>This is just me thinking out loud. Could a library like SignalR help with this? By using a single connection, no longer will I have to create easily consumable URLs like <code>/api/x</code>. Instead, I could create hubs with my API methods I want, and call them in my client code. Authorizing the requests would work as they usually have in the past.</p>




<p>On the surface it sounds like a better idea, but am I missing something? Does it help at all? I could see it providing other benefits, like being able to easily implement multi-user interaction if I wanted in the future.</p>




<p>Would the problem just shift? Now as Joe Developer could I simply reference the generated SignalR scripts and write my own client app? Is it harder or easier to abuse SignalR vs. HTTP URLs?</p>




<p>I don&rsquo;t know yet but I&rsquo;d like to research the topic more; learn more about REST security using tokens and session-based methods.</p>




<h2>Is this even an issue?</h2>




<p>Let&rsquo;s say I implemented and took measures to reduce the likelihood of abuse in my exposed API. Is this even an issue anymore? From what I gather, general consensus is that you can&rsquo;t eliminate the ability for an undesirable user to abuse your API, you can only try to mitigate it as best you can. I still wish it was &ldquo;that easy&rdquo; to secure it. Am I missing something obvious here?</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2012-03-29T21:25:00+00:00" pubdate data-updated="true">Mar 29<span>th</span>, 2012</time>
    


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/posts/37/getting-cassettes-compiled-knockout-templates-to-w">Getting Cassette&#8217;s Compiled Knockout Templates to Work in KO 2.0</a></h2>
  
  <p>
    <p>The Knockout <a href="http://knockoutjs.com/documentation/template-binding.html#note_4_dynamically_choosing_which_template_is_used">template binding</a> documentation does a good job explaining how to use KO with jQuery Templates and even Underscore templates, however, it does not explain how (or if) you can use compiled templates outside of the HTML markup.</p>




<p><a href="http://getcassette.net/documentation/html-templates/knockoutjs-jquery-tmpl">Cassette</a> offers functionality to automatically compile and bundle your HTML templates, making it an excellent tool for more advanced Knockout development where you want to separate your templates. Unfortunately, in KO 2.0.0, it&rsquo;s broken!</p>




<p>The fix is to extend KO&rsquo;s built in jQuery Template engine with some logic to check and see if the named template is already precompiled. KO assumes that the name in a template binding refers to a DOM element with the given ID. Unfortunately, in our case, it refers to the precompiled template name.</p>




<p>Here is a plugin I wrote that fixes this issue. I&rsquo;ve tested it in a limited capacity and I do wonder if <code>text</code> needs to be stubbed out more, but so far this hasn&rsquo;t caused any issues. This should work for adding compiled template support <em>in general</em> to Knockout (for jquery.tmpl), not just Cassette.</p>




<script src="https://gist.github.com/2151977.js?file=knockout.compiledTemplateSource.js"></script>




  </p>
  <span class="meta">
    written 








  



<time datetime="2012-03-22T00:57:31+00:00" pubdate data-updated="true">Mar 22<span>nd</span>, 2012</time>
    


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/posts/35/working-with-computed-columns-in-ef-43">Working With Computed Columns in EF 4.3</a></h2>
  
  <p>
    <p>There&rsquo;s not a ton of information out there on how to handle computed columns in EF. It turns out it is pretty straightforward if you know what to do.</p>




<h2>Telling EF about your computed column</h2>




<p>First, if all you want to do is manually create a function and use it in a column, you only need to decorate your model property with <code>[DatabaseGenerated(DatabaseGeneratedOption.Computed)]</code> as seen here:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">    [DatabaseGenerated(DatabaseGeneratedOption.Computed)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">FullName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>You should know that <strong>if possible, try to keep &ldquo;computed&rdquo; values in your application.</strong> This is my opinion from an ease of use POV, not a design POV. I say it because unless you really <em>need</em> a computed column, you could just as easily create a read-only property that EF ignores.</p>




<p>However, in some cases, a computed column is a viable option such as when you need to sort (on the database-side) against a computed value. That was my own reason for using a computed.</p>




<h2>Manually adding the function and column</h2>




<p>We&rsquo;ve told EF to ignore our property and treat it as a computed column. Now how do we actually <em>create</em> the column? Well, what I did previous to EF Migrations was to just do it all manually through SQL Management Studio. This is entirely OK to do, you just need to make sure you save the script somewhere or remember to do it anytime you create a new database for your application.</p>




<p>You can now go into SSMS and delete the column EF generated (or add it if it&rsquo;s new). Make sure you create your function first:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">GetFullName</span><span class="p">]</span>
</span><span class='line'><span class="p">(</span>
</span><span class='line'>    <span class="c1">&mdash; Add the parameters for the function here</span>
</span><span class='line'>    <span class="o">@</span><span class="n">FirstName</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
</span><span class='line'>    <span class="o">@</span><span class="n">LastName</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'><span class="k">RETURNS</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
</span><span class='line'><span class="k">AS</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'>    <span class="k">DECLARE</span> <span class="o">@</span><span class="n">FullName</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">SELECT</span> <span class="o">@</span><span class="n">FullName</span> <span class="o">=</span> <span class="o">@</span><span class="n">FirstName</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="o">@</span><span class="n">LastName</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">RETURN</span> <span class="o">@</span><span class="n">FullName</span><span class="p">;</span>
</span><span class='line'><span class="k">END</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>That approach worked fine for me, since I use Schema Compare (or used to!) to migrate my database between environments.</p>




<h2>Using EF Migrations</h2>




<p>Now that EF 4.3 has been released, we can all enjoy the benefit of <a href="http://blogs.msdn.com/b/adonet/archive/2012/02/09/ef-4-3-automatic-migrations-walkthrough.aspx">Database Migrations</a>. What I like about this approach is that it&rsquo;s very deliberate and discoverable. I could clone my repository onto a new PC and run the <code>Update-Database</code> command to do <em>everything</em>, plus now we can migrate backwards if needed. It&rsquo;s excellent!</p>




<p>I am using automatic migrations for <a href="http://keeptrackofmygames.com">KTOMG</a>, so what I had to do first was manually create a new migration in the Package Manager console:</p>




<pre><code>$&gt; Add-Migration CustomFunction
</code></pre>




<p>This will scaffold a new, empty migration:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">CustomFunction</span> <span class="p">:</span> <span class="n">DbMigration</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Up</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Down</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Now we can be really cool cats. In this migration, all we have to do is execute our <code>CREATE FUNCTION</code> SQL statement in the <code>Up</code> method, along with dropping and re-adding the column:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Up</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Create function</span>
</span><span class='line'>    <span class="n">Sql</span><span class="p">(</span><span class="s">@&quot;</span>
</span><span class='line'><span class="s">CREATE FUNCTION [dbo].[GetFullName] </span>
</span><span class='line'><span class="s">(</span>
</span><span class='line'><span class="s">&mdash; Add the parameters for the function here</span>
</span><span class='line'><span class="s">@FirstName varchar(50),</span>
</span><span class='line'><span class="s">@LastName varchar(50)</span>
</span><span class='line'><span class="s">)</span>
</span><span class='line'><span class="s">RETURNS varchar(255)</span>
</span><span class='line'><span class="s">AS</span>
</span><span class='line'><span class="s">BEGIN</span>
</span><span class='line'><span class="s">DECLARE @FullName varchar(255);</span>
</span><span class='line'>
</span><span class='line'><span class="s">SELECT @FullName = @FirstName + &#39; &#39; + @LastName;</span>
</span><span class='line'>
</span><span class='line'><span class="s">RETURN @FullName;</span>
</span><span class='line'><span class="s">END</span>
</span><span class='line'><span class="s">&quot;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Add the computed column</span>
</span><span class='line'>    <span class="n">DropColumn</span><span class="p">(</span><span class="s">&quot;Person&quot;</span><span class="p">,</span> <span class="s">&quot;FullName&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Sql</span><span class="p">(</span><span class="s">@&quot;</span>
</span><span class='line'><span class="s">ALTER TABLE [dbo].[Person]</span>
</span><span class='line'><span class="s">ADD [FullName] AS ([dbo].<a href="[FirstName],[LastName]">GetFullName</a>);</span>
</span><span class='line'><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Take note of the <code>true</code> parameter at the end of the <code>Sql()</code> call. This explicitly tells EF <em>not</em> to include the statement in the migration transaction. If you don&rsquo;t do this, SQL Server will complain that the CREATE FUNCTION statement must be the only one in the batch.</p>




<p>Now let&rsquo;s scaffold our tear down step. We should drop the column first, drop the function, and then finally re-add the basic column back.</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Down</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">DropColumn</span><span class="p">(</span><span class="s">&quot;Person&quot;</span><span class="p">,</span> <span class="s">&quot;FullName&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Sql</span><span class="p">(</span><span class="s">&quot;DROP FUNCTION [dbo].[GetFullName]&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">AddColumn</span><span class="p">(</span><span class="s">&quot;Person&quot;</span><span class="p">,</span> <span class="s">&quot;FullName&quot;</span><span class="p">,</span> <span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">String</span><span class="p">(</span><span class="n">nullable</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span> <span class="n">maxLength</span><span class="p">:</span> <span class="m">255</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>I would take care to make sure the column is re-created using the original schema EF created.</p>




<p>Now we can tell EF to migrate to the latest version:</p>




<pre><code>$&gt; Update-Database -Verbose (or -Script, to preview)
</code></pre>




<p>Voila, you should now have a brand spankin&#8217; new computed column.</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2012-03-18T04:38:15+00:00" pubdate data-updated="true">Mar 18<span>th</span>, 2012</time>
    


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/posts/34/i-wish-i-could-do-all-the-things">I Wish I Could Do All the Things</a></h2>
  
  <p>
    <p>Do you ever have the problem where you have so many &ldquo;cool&rdquo; ideas you want to work on, but don&rsquo;t have enough time? When I started out in web development, I had a ton of time, being a high school student. I ran out of ideas by the time I was in college, but now after some time working &ldquo;in the real world,&rdquo; I&rsquo;ve lately had a torrent of ideas that I wish I could spend time on. For some, I&rsquo;ve started on them, but I find it hard to make time for them.</p>




<h2>The Ideas</h2>




<p>Here&rsquo;s a rundown of all the ideas in my head that I wish I could spend time on:</p>




<ul>
<li>A web-based multiplayer game (I have started working on this)</li>
<li>A web app related to coding (I started it a little)</li>
<li>A web site (just ideas written down)</li>
<li>A project for work (I started a little)</li>
<li>A crazy idea for an app (IDE?) for writing code (yah, right, I&rsquo;ll never be able to do this&hellip; unless it was web-based)</li>
<li>A GitHub-style front-end for TFS because TFS is not social</li>
<li><a href="http://keeptrackofmygames.com">Keep Track of My Games</a> (v1 finished, but wish I could work on v2)</li>
<li><a href="http://getcassette.net">Cassette</a> for Node.js

<ul>
<li>I have no idea if this makes sense for Node, but I&rsquo;ve found existing asset management packages not as easy to use as Cassette</li>
</ul>
</li>
</ul>




<p>You can be sure there&rsquo;s more but these are off the top of my head.</p>




<h2>What&rsquo;s blocking?</h2>




<p>Is it totally true I don&rsquo;t have time to work on these? Not exactly. My problem is that having two really big hobbies (gaming + development) and having to work in one hobby (development) conflict with each other. After coming home from developing all day, I am sometimes motivated to work hard on an idea for a few hours (or all night) but that quickly turns to me being burnt out and I have a hard time recovering from it to continue being motivated to work on an idea. More often, I want to relax and play some games or spend time with friends.</p>




<p>The other issue is that my idea list and what I <em>want</em> for each of these ideas quickly turns into a humongous wish list and I start to doubt I can even begin to finish the list. I&rsquo;ve done enough &ldquo;agile&rdquo; development at work to realize I can prioritize and start small and then iterate, which is what I did with KTOMG but then I have so many other ideas, it still feels like too much.</p>




<p>Money is also an issue. I want to implement this and that, but it&rsquo;s going to cost <em>me</em> money to do it. I have loans to pay off (thanks, education), a car to payoff, and rent to pay, not to mention daily or life expenses. I already spend quite a bit and KTOMG still costs me a fair amount to keep running (especially now that AppHarbor has $10 custom domains and $20 SSL). Partly that is dictated by technology, right? I could write everything in PHP and pay for cheap hosting, but I like being a .NET developer and lately I like being a Node/JS developer. Furthermore, complex ideas sometimes need complex hosting. KTOMG has a scheduled job but because I&rsquo;m cheap, it&rsquo;s not a background worker&hellip; it&rsquo;s a scheduled URL request to a &ldquo;secret&rdquo; URL that initiates a 2 minute job. My database is hosted at a different host, which makes the site slower because it&rsquo;s expensive to host SQL Server on AppHarbor.</p>




<p>If an idea I had were to generate revenue, and several of my ideas I&rsquo;m working on <em>could</em>, expenses would be less of an issue. When I released TorrentTyphoon, hosting was cheap and the site paid for itself (I think during my 4 years of high school I made around $10,000 in freelance and ad revenue). The main issue is that I still need to pay for the idea while I&rsquo;m developing it or testing it, and what happens if I release it and it goes nowhere? I&rsquo;m the one who has to pay for it.</p>




<h2>So what&rsquo;s the solution?</h2>




<p>I&rsquo;ve found that if I <em>force myself to start</em> working on an idea, I will be carried off and will work on it continuously for awhile. The hard part is actually sitting down and opening up the project. For KTOMG, I said to myself that I&rsquo;d spend an hour a day for a week working on the site. What happened was that &ldquo;hour&rdquo; turned into several hours and it was really fun. The reward was making an app that actually accomplished what I wanted. Then the ideas started getting bigger (make it AJAX, support multiple release dates, let me organize, let me tag, etc. etc.) and it&rsquo;s almost as if I became scared to work on it&hellip; for fear of it taking so much time; <em>plus</em> those features were not the core of what I wanted for myself, and if I don&rsquo;t really want to use them, what&rsquo;s the motivation for me to implement them? There are around 80 people that use the site&hellip; and it does <em>exactly what I need it to</em>. It&rsquo;s hard for me to justify spending time adding more features, <em>even though I realize deep down it&rsquo;ll attract more users.</em></p>




<p>What I have had luck with is creating and working on tiny ideas. DotJson was a tiny idea. My latest UnderscoreKO was a tiny idea. This site was a tiny idea. These ideas are 1 week projects or less and they have a finite end, which I seem to do better on. They are spawned because <em>I</em> want to use them and I make them public so others can too.</p>




<p>I&rsquo;ve also learned, as I related above, that &ldquo;chunked&rdquo; development works well for me. Spend an hour a day, or aim to spend 5 hours a week, if I make the goal small, I tend to have more fun which makes me more motivated. If I start to see a working prototype or actual result, it snowballs until I finish something consumable. The other thing that motivates me pretty well is doing something new; developing a game is not something I&rsquo;ve done before, and getting a chance to learn Node.js, Socket.io, and other new stuff is pretty fun.</p>




<p>The other thing that seems to help is working with someone else. Even if it&rsquo;s bouncing ideas, or including them in my repository, it becomes fun to work on an idea. So far I haven&rsquo;t had a chance to work with someone <em>coding-wise</em> on an idea, but I&rsquo;ve had the chance to do feature or mechanic work with other people. Everyone else is just as busy, or more busy, than I am.</p>




<p>Finally, one of the things I could do is to throw my ideas and all my documentation out there and let someone else run with it. The problem with that, is that I&rsquo;d be worried I wouldn&rsquo;t have a say in what happens or worse, would lose control of the idea. The last thing I want is for someone else to take my idea, not tell me, and then profit off of it. Perhaps that&rsquo;s a cynical point of view but it is something I worry about. For things that I know I probably don&rsquo;t have enough knowledge to do or are just &ldquo;Wouldn&rsquo;t it be nice?&rdquo; ideas, I don&rsquo;t mind sharing them (like some ideas I listed above).</p>




<p>Does anyone else have this problem? Have you had it and solved it? Do you have it and wish you could solve it? I&rsquo;m interested in knowing.</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2012-03-16T21:29:32+00:00" pubdate data-updated="true">Mar 16<span>th</span>, 2012</time>
    


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/posts/33/underscoreko-want-some-lumps-of-underscorejs-sugar">UnderscoreKO - Want Some Lumps of Underscore.js Sugar in Your Knockout Java?</a></h2>
  
  <p>
    <p>I&rsquo;ve been using <a href="http://knockoutjs.com/">Knockout</a> at work for a MVC3 project and I have also been using <a href="http://documentcloud.github.com/backbone/">Backbone.js</a> in some personal projects at home. I really love <a href="http://documentcloud.github.com/underscore/">Underscore</a> and the array manipulation it offers for Node and the browser. I also liked how it was integrated into Backbone collections.</p>




<p>Yesterday evening as I drove home from work, I had a crazy idea. An idea so simple, I was really surprised <a href="https://github.com/thelinuxlich/knockout.underscore.plugin">only one other person</a> (that a 1 second Google search turned up) made an attempt to do. Maybe <em>because</em> it&rsquo;s so simple, no one bothered to make their code public.</p>




<p>Can you guess what my idea was? C&#8217;mon, isn&rsquo;t it obvious? <em>Why not marry Underscore&rsquo;s array methods to Knockout&rsquo;s observable arrays?</em> And <strong>BAM</strong>, in one evening, <strong>a tiny library named <a href="https://github.com/kamranayub/UnderscoreKO">UnderscoreKO</a> was born.</strong> It&rsquo;s really very cute. It took me maybe 20 minutes to write the library and then 3 hours to write the tests and package it up. Go figure.</p>




<h2>Get UnderscoreKO</h2>




<p>You can download the <a href="http://nuget.org/packages/UnderscoreKO">UnderscoreKO package off of Nuget</a>, since I know that&rsquo;s how a lot of you roll.</p>




<p>The source is <a href="https://github.com/kamranayub/UnderscoreKO">also available on GitHub</a>.</p>




<h2>Let&rsquo;s see some code</h2>




<p>First, let&rsquo;s see what life was like before UKO:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">vm</span><span class="p">.</span><span class="nx">computedArray</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// marry the two arrays</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">union</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">someArray</span><span class="p">(),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>
</span><span class='line'><span class="p">},</span> <span class="nx">vm</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>So what problem have I &ldquo;solved&rdquo;? A small one, but I hope small enough that you&rsquo;ll miss it when you can&rsquo;t do it (those are the best, right?):</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">vm</span><span class="p">.</span><span class="nx">computedArray</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// marry the two arrays</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">someArray</span><span class="p">.</span><span class="nx">union</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>
</span><span class='line'><span class="p">},</span> <span class="nx">vm</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Do you see it? Here, let me zoom in:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">someArray</span><span class="p">.</span><span class="nx">union</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>That&rsquo;s right! All of Underscore&rsquo;s array and collection methods are now available off of observable arrays! You didn&rsquo;t even know you wanted this, right?</p>




<h2>Mutators</h2>




<p><a href="https://github.com/thelinuxlich/knockout.underscore.plugin">thelinuxlich</a> had a neat feature in her plugin which was the idea of &ldquo;destructive&rdquo; methods that were basically convenience methods to manipulate the observable array directly.</p>




<p>In other words, this:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">vm</span><span class="p">.</span><span class="nx">myObservableArray</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">myObservableArray</span><span class="p">.</span><span class="nx">union</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]));</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Becomes this:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">vm</span><span class="p">.</span><span class="nx">myObservableArray</span><span class="p">.</span><span class="nx">union_</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>See? Isn&rsquo;t that a little nicer? I added &ldquo;mutator&rdquo; methods (<em>methodName_</em>) for anything I felt you&rsquo;d want to use to manipulate the array. And of course, they still use Knockout underneath so change notifications still occur.</p>




<h2>Features</h2>




<p>Um&hellip; what you&rsquo;d expect? <strike>Actually, there are a couple issues I&rsquo;d like to address tonight in another update (such as adding <code>chain</code> which I forgot about and taking care of passing in <code>observableArrays</code> to some functions like <code>union</code> so you don&rsquo;t have to do this: <code>vm.myObservableArray.union_(vm.array1(), vm.array2(), ...)</code>).</strike> I&rsquo;ve released v1.1 which fixes a mutator bug, adds <code>chain()</code> support, and invokes KO arrays when passed to certain functions like <em>union</em>.</p>




<h2>Live Demo</h2>




<p>Want to try before you buy? Go ahead!</p>




<iframe style="width: 100%; height: 300px" src="http://jsfiddle.net/kamranayub/exnqe/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>




  </p>
  <span class="meta">
    written 








  



<time datetime="2012-03-13T19:33:19+00:00" pubdate data-updated="true">Mar 13<span>th</span>, 2012</time>
    


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/posts/32/using-nuspec-inheritance-to-reduce-nuget-maintenan">Using Nuspec Inheritance to Reduce Nuget Maintenance Headaches</a></h2>
  
  <p>
    <p>I&rsquo;ve been <a href="https://github.com/andrewdavey/cassette/pull/191">helping Cassette support .NET 3.5</a> and it&rsquo;s the biggest open source contribution I&rsquo;ve ever made. Granted, I started it so that we could use Cassette at work but I did it of my own accord. I learned a lot in the process (which I&rsquo;ll write another post on) but I thought I&rsquo;d talk about a cool trick I came up with to help ease Cassette&rsquo;s Nuget packaging burden.</p>




<h2>The Problem</h2>




<p>Cassette has 7 Nuget packages:</p>




<ul>
<li>Cassette + symbols</li>
<li>Cassette.Views + symbols</li>
<li>Cassette.Web + symbols</li>
<li>Cassette.MSBuild</li>
</ul>




<p>This means Andrew has to maintain 7 separate Nuspec files. Imagine now if we were forced to create a new .NET 3.5-specific Nuget package or MVC2-specific package or whatever; we&rsquo;d have even more Nuspecs to deal with.</p>




<p>What&rsquo;s even worse is that all the Nuspec files share common metadata. Typically the only metadata that differs is: <code>id</code>, <code>description</code>, <code>dependencies</code>, and <code>references</code>.</p>




<h2>XDT Transformations to the Rescue</h2>




<p>In MSBuild 4, Microsoft introduced the concept of <a href="http://msdn.microsoft.com/en-us/library/dd465326.aspx">XML Document Transformation</a>. This made it really helpful to create Debug/Release-specific <code>web.config</code> files for your site.</p>




<p>However, what you may not know is that XDT can be used on <em>any</em> document. It can <a href="http://geekswithblogs.net/EltonStoneman/archive/2010/08/20/using-msbuild-4.0-web.config-transformation-to-generate-any-config-file.aspx">also be used manually</a> in your MSBuild file:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;UsingTask</span> <span class="na">TaskName=</span><span class="s">&quot;TransformXml&quot;</span> <span class="na">AssemblyFile=</span><span class="s">&quot;$(MSBuildExtensionPath)\Microsoft\VisualStudio\v10.0\Web\Microsoft.Web.Publishing.Tasks.dll&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">&quot;GenerateConfigs&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;MakeDir</span> <span class="na">Directories=</span><span class="s">&quot;$(BuildOutput)&quot;</span> <span class="na">Condition=</span><span class="s">&quot;!Exists(&#39;$(BuildOutput)&#39;)&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;TransformXml</span> <span class="na">Source=</span><span class="s">&quot;Web.config&quot;</span>
</span><span class='line'>                  <span class="na">Transform=</span><span class="s">&quot;Web.$(Configuration).config&quot;</span>
</span><span class='line'>                  <span class="na">Destination=</span><span class="s">&quot;$(BuildOutput)\Web.config&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/Target&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Neat. I thought about this a bit and figured, &ldquo;Hey, why not use this to reduce Nuspec maintenance headache!&rdquo;</p>




<p>So I did a toy exercise by creating a <code>Cassette.Shared.nuspec</code> file:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span class='line'><span class="c">&lt;!&mdash; Cassette Shared Nuspec File; all packges share this &mdash;&gt;</span>
</span><span class='line'><span class="nt">&lt;package</span> <span class="na">xmlns=</span><span class="s">&quot;<a href="http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd&amp;quot;">http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd&amp;quot;</a></span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;metadata&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>$version$<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;authors&gt;</span>Andrew Davey<span class="nt">&lt;/authors&gt;</span>
</span><span class='line'>    <span class="nt">&lt;owners&gt;</span>Andrew Davey<span class="nt">&lt;/owners&gt;</span>
</span><span class='line'>    <span class="nt">&lt;copyright&gt;</span>© 2011 Andrew Davey<span class="nt">&lt;/copyright&gt;</span>
</span><span class='line'>    <span class="nt">&lt;licenseUrl&gt;</span><a href="http://getcassette.net/licensing">http://getcassette.net/licensing</a><span class="nt">&lt;/licenseUrl&gt;</span>
</span><span class='line'>    <span class="nt">&lt;projectUrl&gt;</span><a href="http://getcassette.net/">http://getcassette.net/</a><span class="nt">&lt;/projectUrl&gt;</span>
</span><span class='line'>    <span class="nt">&lt;tags&gt;</span>web javascript coffeescript css html templates asp.net<span class="nt">&lt;/tags&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/metadata&gt;</span>
</span><span class='line'><span class="nt">&lt;/package&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>And a &ldquo;Cassette.Web.nutrans&rdquo; transformation file that just added the extra data required:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;package</span> <span class="na">xmlns=</span><span class="s">&quot;<a href="http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd&amp;quot;">http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd&amp;quot;</a></span> <span class="na">xmlns:xdt=</span><span class="s">&quot;<a href="http://schemas.microsoft.com/XML-Document-Transform&amp;quot;">http://schemas.microsoft.com/XML-Document-Transform&amp;quot;</a></span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;metadata&gt;</span>
</span><span class='line'>        <span class="nt">&lt;id</span> <span class="na">xdt:Transform=</span><span class="s">&quot;Insert&quot;</span><span class="nt">&gt;</span>Cassette.Web<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>        <span class="nt">&lt;description</span> <span class="na">xdt:Transform=</span><span class="s">&quot;Insert&quot;</span><span class="nt">&gt;</span>ASP.NET support for Cassette. Cassette automatically builds JavaScript, CSS and HTML template modules based on the dependencies between files. CoffeeScript and LESS are also supported.<span class="nt">&lt;/description&gt;</span>
</span><span class='line'>        <span class="nt">&lt;dependencies</span> <span class="na">xdt:Transform=</span><span class="s">&quot;Insert&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;dependency</span> <span class="na">id=</span><span class="s">&quot;Cassette&quot;</span> <span class="na">version=</span><span class="s">&quot;$version$&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;dependency</span> <span class="na">id=</span><span class="s">&quot;Cassette.Views&quot;</span> <span class="na">version=</span><span class="s">&quot;$version$&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/dependencies&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/metadata&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;files</span> <span class="na">xdt:Transform=</span><span class="s">&quot;Insert&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;file</span> <span class="na">src=</span><span class="s">&quot;....\build\bin\lib40\Cassette.Web.dll&quot;</span> <span class="na">target=</span><span class="s">&quot;lib\net40&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;file</span> <span class="na">src=</span><span class="s">&quot;....\build\bin\lib35\Cassette.Web.dll&quot;</span> <span class="na">target=</span><span class="s">&quot;lib\net35&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;file</span> <span class="na">src=</span><span class="s">&quot;CassetteConfiguration.cs.pp&quot;</span> <span class="na">target=</span><span class="s">&quot;content&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;file</span> <span class="na">src=</span><span class="s">&quot;web.config.transform&quot;</span> <span class="na">target=</span><span class="s">&quot;content&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/files&gt;</span>
</span><span class='line'><span class="nt">&lt;/package&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><strong>Mind = blown.</strong> It worked! As I stroked my five-o-clock shadow, I wondered. <em>Wow, if this works, how far can we take it?</em></p>




<h2>Nuspec Inheritance: Say what?!</h2>




<p>Let&rsquo;s consider the symbols packaging for Cassette. Being able to transform all these Nuspecs is great and will reduce headaches, but what happens when a Nuspec is a subset of yet another Nuspec? The symbols package typically just adds some PDB files and a <code>**\*.cs</code> line.</p>




<p>Furthermore, I&rsquo;d <strong>really</strong> like to avoid calling the <code>TransformXml</code> task on each symbols Nuspec individually.</p>




<p>No, what I really want is a way to make my Nuspecs inherit from each other to create a chain of transformation.</p>




<p><strong>So that&rsquo;s what I did.</strong> Nuget package developers of the world, I present to you an inline MSBuild task that will follow a chain of inheritance and transform your Nuspecs:</p>




<script src="https://gist.github.com/1918022.js?file=Transforms.xml"></script>




<p>It looks complicated but it really isn&rsquo;t. I had to workaround <a href="http://stackoverflow.com/questions/9455354/msbuild-inline-task-reference-non-standard-microsoft-assemblies">an issue with MSBuild inline tasks</a> by loading up the Microsoft.Web.Publishing.Tasks assembly via Reflection. The rest of the code discovers the inheritance chain and performs the transformations. I developed this in a standalone console application first, then copy/pasted it into the inline task definition, changing whatever I needed.</p>




<p>I could have made this into a standalone DLL but what fun is that? Then I&rsquo;d have to manage a solution and project and blah blah blah. No, I wanted this to be simple and easy to just add to any MSBuild project.</p>




<h2>Example Usage</h2>




<p>Let&rsquo;s take the symbols example now and see what we can do.</p>




<p><strong>Cassette.Web.nutrans</strong></p>




<p>We have to add an extra attribute to the <code>&lt;package&gt;</code> element:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;package</span> <span class="na">inherits=</span><span class="s">&quot;../Cassette.Shared.nuspec&quot;</span> <span class="err">&hellip;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>The <code>inherits</code> attribute is relative to the directory the nutrans file is in.</p>




<p><strong>Cassette.Web.symbols.nutrans</strong></p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;package</span> <span class="na">inherits=</span><span class="s">&quot;Cassette.Web.nutrans&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;<a href="http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd&amp;quot;">http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd&amp;quot;</a></span> <span class="na">xmlns:xdt=</span><span class="s">&quot;<a href="http://schemas.microsoft.com/XML-Document-Transform&amp;quot;">http://schemas.microsoft.com/XML-Document-Transform&amp;quot;</a></span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;files&gt;</span>
</span><span class='line'>    <span class="nt">&lt;file</span> <span class="na">xdt:Transform=</span><span class="s">&quot;Insert&quot;</span> <span class="na">src=</span><span class="s">&quot;....\build\bin\lib40\Cassette.Web.pdb&quot;</span> <span class="na">target=</span><span class="s">&quot;lib\net40&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;file</span> <span class="na">xdt:Transform=</span><span class="s">&quot;Insert&quot;</span> <span class="na">src=</span><span class="s">&quot;....\build\bin\lib35\Cassette.Web.pdb&quot;</span> <span class="na">target=</span><span class="s">&quot;lib\net35&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;file</span> <span class="na">xdt:Transform=</span><span class="s">&quot;Insert&quot;</span> <span class="na">src=</span><span class="s">&quot;***.cs&quot;</span> <span class="na">target=</span><span class="s">&quot;src&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/files&gt;</span>
</span><span class='line'><span class="nt">&lt;/package&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Now, using the <code>inherits</code> attribute, we can transform the Cassette.Web transformation file letting us create a chain of transformations.</p>




<p>To use this task, we can easily pass it the list of transforms to use and let it work its magic.</p>




<p><strong>build.xml</strong></p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">&quot;NugetPack&quot;</span> <span class="na">DependsOnTargets=</span><span class="s">&quot;Build&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;ItemGroup&gt;</span>
</span><span class='line'>            <span class="nt">&lt;Transforms</span> <span class="na">Include=</span><span class="s">&quot;src***.nutrans&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/ItemGroup&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!&mdash; Transform Nuspecs &mdash;&gt;</span>
</span><span class='line'>        <span class="nt">&lt;TransformXmlHierarchy</span>
</span><span class='line'>            <span class="na">Source=</span><span class="s">&quot;%(Transforms.Identity)&quot;</span>
</span><span class='line'>            <span class="na">Destination=</span><span class="s">&quot;src\%(Transforms.RecursiveDir)%(Transforms.Filename).nuspec&quot;</span>
</span><span class='line'>            <span class="na">TaskDirectory=</span><span class="s">&quot;$(MSBuildExtensionsPath)\Microsoft\VisualStudio\v10.0\Web&amp;quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/Target&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>And there you have it! For every transform file MSBuild finds, it will execute our task and generate our Nuspec files so they all contain the same shared metadata. I hope this makes someone&rsquo;s Nuget packaging life easier.</p>




<p>You can find the source and examples <a href="https://gist.github.com/1918022">in my gist</a>.</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2012-02-27T02:16:16+00:00" pubdate data-updated="true">Feb 27<span>th</span>, 2012</time>
    


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/posts/31/this-this-is-ux">This&#8230; This Is UX</a></h2>
  
  <p>
    <p><img src="/blog/images/36.png" alt="UX in Action" /></p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2012-02-22T20:18:10+00:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2012</time>
    


  </span>

  
</article>

            </div>
          </div>
        
          
          <div class="row">
            <div class="col-md-offset-2 col-md-8">
              <article>
  <h2><a href="/blog/posts/30/playing-with-node-writing-a-reddit-cli">Playing With Node: Writing a Reddit CLI</a></h2>
  
  <p>
    <p>This is not a complete post about how to write a fully featured CLI application for Reddit, like <a href="http://cortex.glacicle.org/">Cortex</a>. However, I think it demonstrates the ease and simplicity in making such an application.</p>




<h3>The idea</h3>




<p>I love <a href="http://reddit.com">Reddit</a>. Except for one thing: I don&rsquo;t have much time to browse or keep up with it due to life getting in the way. What I wanted was a simple app I could run that would simply show me the top stories at that moment so I could glance at them and visit them.</p>




<p>I spent about 20 mins (mostly looking for CLI npm packages) and came up with this:</p>




<p><img src="/blog/images/35.png" alt="Reddit CLI" /></p>




<p>Pretty simple. It goes to the front page, grabs the JSON results, and formats it all into a nice list (shortening titles if they get too uppity), displaying the information I mostly care about: subreddit, score, # of comments, and the poster.</p>




<p>Now, I haven&rsquo;t yet implemented a way to actually visit the URL of any of these, mainly because I&rsquo;m short on time. But maybe you can!</p>




<h3>The code</h3>




<p>The code is pretty straightforward. I&rsquo;m using the <a href="http://search.npmjs.org/#/colors">colors</a>, <a href="http://search.npmjs.org/#/request">request</a>, and <a href="http://search.npmjs.org/#/cli">cli</a> npm packages.</p>




<p>I wanted to do something really quick. The <code>cli</code> package is way more than I need, in fact, I wrote this originally without using <code>cli</code> but for future improvement I added it in. The steps I wanted to perform from the get-go were:</p>




<ol>
<li>Get the JSON for the homepage</li>
<li>Parse it and build a colorized &ldquo;row&rdquo; (two rows, in fact)</li>
<li>Trim titles so they didn&rsquo;t mess up the flow (my console window is 140 columns)</li>
</ol>




<p>Here it is, all 43 lines of it:</p>


<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">cli</span>     <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cli&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">http</span>    <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">colors</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;colors&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">cli</span><span class="p">.</span><span class="nx">main</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;<strong><strong><strong><strong><strong><em>&quot;</span><span class="p">.</span><span class="nx">rainbow</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Node Reddit&quot;</span><span class="p">.</span><span class="nx">cyan</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;</em></strong></strong></strong></strong></strong>\n\n&quot;</span><span class="p">.</span><span class="nx">rainbow</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">request</span><span class="p">(</span><span class="s1">&#39;<a href="http://reddit.com/.json&amp;#39;">http://reddit.com/.json&amp;#39;</a></span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">reddit</span>  <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">body</span><span class="p">),</span>
</span><span class='line'>          <span class="nx">stories</span> <span class="o">=</span> <span class="nx">reddit</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                      <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span><span class='line'>                    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Descending score</span>
</span><span class='line'>      <span class="nx">stories</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">b</span><span class="p">.</span><span class="nx">score</span> <span class="o">&ndash;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">score</span><span class="p">;</span> <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">stories</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">story</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">title</span> <span class="o">=</span> <span class="nx">story</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">100</span>
</span><span class='line'>                <span class="o">?</span> <span class="nx">story</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&hellip;&quot;</span>
</span><span class='line'>                <span class="o">:</span> <span class="nx">story</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Build row</span>
</span><span class='line'>        <span class="c1">// [score] [title] [comments] [subreddit]</span>
</span><span class='line'>        <span class="c1">// This sucks</span>
</span><span class='line'>        <span class="nx">row</span> <span class="o">+=</span> <span class="nx">story</span><span class="p">.</span><span class="nx">score</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">green</span> <span class="o">+</span> <span class="s2">&quot;\t&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">row</span> <span class="o">+=</span> <span class="nx">title</span><span class="p">.</span><span class="nx">bold</span>
</span><span class='line'>        <span class="nx">row</span> <span class="o">+=</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="nx">story</span><span class="p">.</span><span class="nx">domain</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">row</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot; /r/&quot;</span> <span class="o">+</span> <span class="nx">story</span><span class="p">.</span><span class="nx">subreddit</span><span class="p">).</span><span class="nx">cyan</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">row</span> <span class="o">+=</span> <span class="s2">&quot;\n\t&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">row</span> <span class="o">+=</span> <span class="nx">story</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">grey</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">row</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">story</span><span class="p">.</span><span class="nx">num_comments</span> <span class="o">+</span> <span class="s2">&quot; comments&quot;</span><span class="p">).</span><span class="nx">italic</span><span class="p">.</span><span class="nx">yellow</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">row</span> <span class="o">+=</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>As you can see, definitely pretty light. That&rsquo;s all there is to it. Now imagine adding in commands (via <code>cli.parse</code>) or even <a href="http://search.npmjs.org/#/growl">growl</a> support (I forked it and added Growl for Windows support, hopefully I can get it working decently and commit it). Then letting it monitor your specific subreddits, perhaps once every 15 minutes or so. Then adding in support for viewing links (interactive CLI app).</p>




<p>That&rsquo;s all more than I have time for, but maybe some of you that want to learn more about the Power of Node have more time. If so, I welcome additions.</p>




<p>It&rsquo;s <a href="https://github.com/kamranayub/node-reddit">available on GitHub</a>. Feel free to dissect it and improve it, fork it and b0rk it. Have fun!</p>


  </p>
  <span class="meta">
    written 








  



<time datetime="2012-02-02T21:21:04+00:00" pubdate data-updated="true">Feb 2<span>nd</span>, 2012</time>
    


  </span>

  
</article>

            </div>
          </div>
        
      </div>
    </div>

    <hr class="divider-short"/>

    <div class="archive-link">
      <h3><a href="/blog/archives/">All Posts</a></h3>
    </div>
  </div>
</div>

    <footer id="footer" class="her-row">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
  <a href="/"><h4>Home</h4></a>
</div>

<div class="col-md-2">
  <div class="social-icon-list">
    
    <a href="https://twitter.com/kamranayub"><img src="/images/glyphicons_social_31_twitter.png"/></a>
    

    
    <a href="https://github.com/kamranayub"><img src="/images/glyphicons_social_21_github.png"/></a>
    

    

    
  </div>
</div>

<div class="pull-right">
  <h4>Powered by <a href="http://octopress.org/">Octopress</a>. Designed by <a href="http://AdrianArtiles.com">Adrian Artiles</a>.</h4>
</div>


    </div>
  </div>
</footer>

    
  </body>
</html>
